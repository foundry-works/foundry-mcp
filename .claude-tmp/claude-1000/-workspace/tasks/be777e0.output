Traceback (most recent call last):
  File "/tmp/tmp.P4ipaDMZDK", line 1, in <module>
    {"exit_code":0,"stderr":"","stdout":"diff --git a/src/foundry_mcp/config/research.py b/src/foundry_mcp/config/research.py\nindex 5cc8dcc..cfd64e6 100644\n--- a/src/foundry_mcp/config/research.py\n+++ b/src/foundry_mcp/config/research.py\n@@ -195,6 +195,9 @@ class ResearchConfig:\n     semantic_scholar_sort_order: str = \"desc\"  # Sort direction: asc or desc\n     semantic_scholar_use_extended_fields: bool = True  # Include TLDR and extended metadata\n \n+    # Stale task detection threshold for deep research background tasks\n+    deep_research_stale_task_seconds: float = 300.0  # Seconds of inactivity before a task is considered stale\n+\n     # Status persistence throttling (reduces disk I/O during deep research)\n     status_persistence_throttle_seconds: int = 5  # Minimum seconds between status saves (0 = always persist)\n \n@@ -367,6 +370,8 @@ class ResearchConfig:\n             content_archive_enabled=_parse_bool(data.get(\"content_archive_enabled\", False)),\n             content_archive_ttl_hours=int(data.get(\"content_archive_ttl_hours\", 168)),\n             research_archive_dir=data.get(\"research_archive_dir\"),\n+            # Stale task detection\n+            deep_research_stale_task_seconds=float(data.get(\"deep_research_stale_task_seconds\", 300.0)),\n             # Status persistence throttling\n             status_persistence_throttle_seconds=int(data.get(\"status_persistence_throttle_seconds\", 5)),\n             # Audit verbosity\ndiff --git a/src/foundry_mcp/core/authorization.py b/src/foundry_mcp/core/authorization.py\nindex e2e89db..4a9da70 100644\n--- a/src/foundry_mcp/core/authorization.py\n+++ b/src/foundry_mcp/core/authorization.py\n@@ -163,11 +163,11 @@ def set_server_role(role: str) -> None:\n         Role(role)\n     except ValueError:\n         logger.warning(\n-            \"Invalid role '%s', falling back to maintainer. Valid roles: %s\",\n+            \"Invalid role '%s', falling back to observer (fail-closed). Valid roles: %s\",\n             role,\n             \", \".join(r.value for r in Role),\n         )\n-        role = Role.MAINTAINER.value\n+        role = Role.OBSERVER.value\n \n     global _configured_server_role\n \ndiff --git a/src/foundry_mcp/core/autonomy/orchestrator.py b/src/foundry_mcp/core/autonomy/orchestrator.py\nindex df35ea6..3a29924 100644\n--- a/src/foundry_mcp/core/autonomy/orchestrator.py\n+++ b/src/foundry_mcp/core/autonomy/orchestrator.py\n@@ -27,6 +27,7 @@ from __future__ import annotations\n import hashlib\n import json\n import logging\n+import threading\n from datetime import datetime, timedelta, timezone\n from pathlib import Path\n from typing import Any, Dict, Optional, Tuple\n@@ -136,6 +137,7 @@ class StepOrchestrator(StepEmitterMixin):\n         self.workspace_path = workspace_path or Path.cwd()\n         # Cache: (spec_id, mtime, file_size) -> spec_data\n         self._spec_cache: Optional[Tuple[str, float, int, Dict[str, Any]]] = None\n+        self._spec_cache_lock = threading.Lock()\n         self._context_tracker = ContextTracker(self.workspace_path)\n         # Audit ledger cache keyed by spec_id\n         self._audit_ledgers: Dict[str, AuditLedger] = {}\n@@ -149,10 +151,11 @@ class StepOrchestrator(StepEmitterMixin):\n             spec_id: If provided, only invalidate if cached spec matches.\n                      If None, unconditionally clear the cache.\n         \"\"\"\n-        if spec_id is None:\n-            self._spec_cache = None\n-        elif self._spec_cache is not None and self._spec_cache[0] == spec_id:\n-            self._spec_cache = None\n+        with self._spec_cache_lock:\n+            if spec_id is None:\n+                self._spec_cache = None\n+            elif self._spec_cache is not None and self._spec_cache[0] == spec_id:\n+                self._spec_cache = None\n \n     def _get_ledger(self, spec_id: str) -> AuditLedger:\n         \"\"\"Get or create an audit ledger for the given spec.\"\"\"\n@@ -840,7 +843,8 @@ class StepOrchestrator(StepEmitterMixin):\n                 # which lacks the \"hierarchy\" key that validation requires.\n                 save_spec(session.spec_id, spec_data, specs_dir, validate=False)\n                 # Invalidate spec cache since we just wrote to the file\n-                self._spec_cache = None\n+                with self._spec_cache_lock:\n+                    self._spec_cache = None\n                 logger.info(\n                     \"Orchestrator persisted task completion to spec: session=%s task=%s\",\n                     session.id,\n@@ -1126,33 +1130,36 @@ class StepOrchestrator(StepEmitterMixin):\n                 session.spec_file_size = current_metadata.file_size\n \n                 # Populate spec cache for subsequent calls\n-                self._spec_cache = (\n-                    session.spec_id,\n-                    current_metadata.mtime,\n-                    current_metadata.file_size,\n-                    spec_data,\n-                )\n+                with self._spec_cache_lock:\n+                    self._spec_cache = (\n+                        session.spec_id,\n+                        current_metadata.mtime,\n+                        current_metadata.file_size,\n+                        spec_data,\n+                    )\n \n                 return spec_data, None\n \n             # Fast path: return cached spec_data if available for this mtime\n-            if (\n-                self._spec_cache is not None\n-                and self._spec_cache[0] == session.spec_id\n-                and self._spec_cache[1] == current_metadata.mtime\n-                and self._spec_cache[2] == current_metadata.file_size\n-            ):\n-                return self._spec_cache[3], None\n+            with self._spec_cache_lock:\n+                if (\n+                    self._spec_cache is not None\n+                    and self._spec_cache[0] == session.spec_id\n+                    and self._spec_cache[1] == current_metadata.mtime\n+                    and self._spec_cache[2] == current_metadata.file_size\n+                ):\n+                    return self._spec_cache[3], None\n \n             # Load spec without re-hashing\n             spec_data = self._load_spec_file(spec_path)\n             if spec_data is not None:\n-                self._spec_cache = (\n-                    session.spec_id,\n-                    current_metadata.mtime,\n-                    current_metadata.file_size,\n-                    spec_data,\n-                )\n+                with self._spec_cache_lock:\n+                    self._spec_cache = (\n+                        session.spec_id,\n+                        current_metadata.mtime,\n+                        current_metadata.file_size,\n+                        spec_data,\n+                    )\n             return spec_data, None\n \n         except (OSError, json.JSONDecodeError, ValueError) as e:\ndiff --git a/src/foundry_mcp/core/autonomy/server_secret.py b/src/foundry_mcp/core/autonomy/server_secret.py\nindex 1b1847e..89228ae 100644\n--- a/src/foundry_mcp/core/autonomy/server_secret.py\n+++ b/src/foundry_mcp/core/autonomy/server_secret.py\n@@ -185,8 +185,9 @@ def compute_integrity_checksum(\n     \"\"\"\n     secret = get_server_secret()\n \n-    # Build payload to sign (deterministic serialization)\n-    payload = f\"{gate_attempt_id}:{step_id}:{phase_id}:{verdict}\"\n+    # Build versioned payload to sign (deterministic serialization)\n+    # v1: prefix enables future algorithm rotation without breaking in-flight evidence\n+    payload = f\"v1:{gate_attempt_id}:{step_id}:{phase_id}:{verdict}\"\n \n     # Compute HMAC-SHA256\n     checksum = hmac.new(secret, payload.encode(), hashlib.sha256).hexdigest()\n@@ -220,8 +221,17 @@ def verify_integrity_checksum(\n \n     computed = compute_integrity_checksum(gate_attempt_id, step_id, phase_id, verdict)\n \n-    # Constant-time comparison\n-    return hmac.compare_digest(computed, expected_checksum)\n+    # Constant-time comparison against versioned (v1:) checksum\n+    if hmac.compare_digest(computed, expected_checksum):\n+        return True\n+\n+    # Legacy fallback: accept unversioned checksums generated before v1: migration.\n+    # TODO: Remove this fallback after all in-flight gate evidence has expired\n+    # (safe to remove once no sessions predate the v1: payload change).\n+    secret = get_server_secret()\n+    legacy_payload = f\"{gate_attempt_id}:{step_id}:{phase_id}:{verdict}\"\n+    legacy_checksum = hmac.new(secret, legacy_payload.encode(), hashlib.sha256).hexdigest()\n+    return hmac.compare_digest(legacy_checksum, expected_checksum)\n \n \n # =============================================================================\ndiff --git a/src/foundry_mcp/core/autonomy/write_lock.py b/src/foundry_mcp/core/autonomy/write_lock.py\nindex 8fea38d..3d9db2a 100644\n--- a/src/foundry_mcp/core/autonomy/write_lock.py\n+++ b/src/foundry_mcp/core/autonomy/write_lock.py\n@@ -206,6 +206,17 @@ def _find_active_session_for_spec(\n     Delegates to AutonomyStorage for consistent session discovery\n     using per-spec pointer files.\n \n+    Note on TOCTOU: ``get_active_session()`` returns a session ID from a\n+    pointer file, and ``load()`` then reads the full session JSON \u2014 a\n+    two-step read sequence.  This is *not* a security-relevant TOCTOU\n+    because both operations are reads (no mutation decision is made between\n+    them), and the storage layer's atomic-write guarantees ensure that\n+    ``load()`` always returns a structurally valid session even if a\n+    concurrent writer updates the file between the two calls.  The\n+    double-read is intentional: pointer files are lightweight lookups\n+    while full session loads are heavier, so the pointer check serves as\n+    an early-exit fast path.\n+\n     Args:\n         spec_id: The spec ID to check\n         workspace: Path to workspace\ndiff --git a/src/foundry_mcp/core/research/workflows/deep_research/_helpers.py b/src/foundry_mcp/core/research/workflows/deep_research/_helpers.py\nindex a246040..4f51e58 100644\n--- a/src/foundry_mcp/core/research/workflows/deep_research/_helpers.py\n+++ b/src/foundry_mcp/core/research/workflows/deep_research/_helpers.py\n@@ -7,7 +7,10 @@ module-level functions (not via ``self``).\n from __future__ import annotations\n \n import re\n-from typing import Optional\n+from typing import TYPE_CHECKING, Optional\n+\n+if TYPE_CHECKING:\n+    from foundry_mcp.config.research import ResearchConfig\n \n \n def extract_json(content: str) -> Optional[str]:\n@@ -95,3 +98,25 @@ def truncate_at_boundary(content: str, target_length: int) -> str:\n             truncated = truncated[: sentence_break + 1]\n \n     return truncated.strip() + \"\\n\\n[... content truncated for context limits]\"\n+\n+\n+def resolve_phase_provider(config: \"ResearchConfig\", *phase_names: str) -> str:\n+    \"\"\"Resolve LLM provider ID by trying phase-specific config attrs in order.\n+\n+    Walks *phase_names* and checks\n+    ``config.deep_research_{name}_provider`` for each.  Returns the\n+    first non-None value found, falling back to ``config.default_provider``.\n+\n+    Args:\n+        config: ResearchConfig instance\n+        *phase_names: Config attribute suffixes to check in order\n+            (e.g. ``\"topic_reflection\"``, ``\"reflection\"``).\n+\n+    Returns:\n+        Provider ID string (never None).\n+    \"\"\"\n+    for name in phase_names:\n+        value = getattr(config, f\"deep_research_{name}_provider\", None)\n+        if value is not None:\n+            return value\n+    return config.default_provider\ndiff --git a/src/foundry_mcp/core/research/workflows/deep_research/action_handlers.py b/src/foundry_mcp/core/research/workflows/deep_research/action_handlers.py\nindex 8002ff2..8bde369 100644\n--- a/src/foundry_mcp/core/research/workflows/deep_research/action_handlers.py\n+++ b/src/foundry_mcp/core/research/workflows/deep_research/action_handlers.py\n@@ -335,8 +335,8 @@ class ActionHandlersMixin:\n                 if bg_task.timeout_elapsed_seconds:\n                     metadata[\"timeout_elapsed_seconds\"] = bg_task.timeout_elapsed_seconds\n             if hasattr(bg_task, \"is_stale\") and callable(bg_task.is_stale):\n-                # Check staleness with default threshold (300s)\n-                if bg_task.is_stale(300.0):\n+                # Check staleness with configurable threshold\n+                if bg_task.is_stale(self.config.deep_research_stale_task_seconds):\n                     metadata[\"is_stale\"] = True\n                     metadata[\"last_activity\"] = bg_task.last_activity\n             # Include progress from persisted state if available\ndiff --git a/src/foundry_mcp/core/research/workflows/deep_research/phases/clarification.py b/src/foundry_mcp/core/research/workflows/deep_research/phases/clarification.py\nindex e55b34b..bee8a96 100644\n--- a/src/foundry_mcp/core/research/workflows/deep_research/phases/clarification.py\n+++ b/src/foundry_mcp/core/research/workflows/deep_research/phases/clarification.py\n@@ -246,7 +246,9 @@ IMPORTANT: Return ONLY valid JSON, no markdown formatting or extra text.\"\"\"\n         if isinstance(constraints, dict):\n             # Only keep string-valued constraints, filter empty values\n             result[\"inferred_constraints\"] = {\n-                k: str(v) for k, v in constraints.items() if v and isinstance(v, (str, int, float, bool))\n+                k: (str(v).lower() if isinstance(v, bool) else str(v))\n+                for k, v in constraints.items()\n+                if v is not None and v != \"\" and isinstance(v, (str, int, float, bool))\n             }\n \n         return result\ndiff --git a/src/foundry_mcp/core/research/workflows/deep_research/phases/topic_research.py b/src/foundry_mcp/core/research/workflows/deep_research/phases/topic_research.py\nindex 1093c69..6772a6f 100644\n--- a/src/foundry_mcp/core/research/workflows/deep_research/phases/topic_research.py\n+++ b/src/foundry_mcp/core/research/workflows/deep_research/phases/topic_research.py\n@@ -224,7 +224,11 @@ class TopicResearchMixin:\n         \"\"\"\n         from foundry_mcp.core.research.providers import SearchProviderError\n \n-        effective_max_results = max_sources_per_provider or state.max_sources_per_query\n+        effective_max_results = (\n+            max_sources_per_provider\n+            if max_sources_per_provider is not None\n+            else state.max_sources_per_query\n+        )\n         added = 0\n \n         async with semaphore:\n@@ -337,10 +341,10 @@ class TopicResearchMixin:\n             Dict with keys: sufficient (bool), assessment (str),\n             refined_query (optional str)\n         \"\"\"\n-        provider_id = (\n-            getattr(self.config, \"deep_research_topic_reflection_provider\", None)\n-            or getattr(self.config, \"deep_research_reflection_provider\", None)\n-            or self.config.default_provider\n+        from foundry_mcp.core.research.workflows.deep_research._helpers import resolve_phase_provider\n+\n+        provider_id = resolve_phase_provider(\n+            self.config, \"topic_reflection\", \"reflection\"\n         )\n \n         system_prompt = (\ndiff --git a/src/foundry_mcp/core/research/workflows/deep_research/workflow_execution.py b/src/foundry_mcp/core/research/workflows/deep_research/workflow_execution.py\nindex 981e278..18f4136 100644\n--- a/src/foundry_mcp/core/research/workflows/deep_research/workflow_execution.py\n+++ b/src/foundry_mcp/core/research/workflows/deep_research/workflow_execution.py\n@@ -19,6 +19,9 @@ from foundry_mcp.core.research.models.deep_research import (\n     DeepResearchState,\n )\n from foundry_mcp.core.research.workflows.base import WorkflowResult\n+from foundry_mcp.core.research.workflows.deep_research._helpers import (\n+    resolve_phase_provider,\n+)\n from foundry_mcp.core.research.workflows.deep_research.source_quality import (\n     _extract_hostname,\n )\n@@ -243,9 +246,8 @@ class WorkflowExecutionMixin:\n                     DeepResearchPhase.CLARIFICATION,\n                     self._execute_clarification_async(\n                         state=state,\n-                        provider_id=(\n-                            getattr(self.config, \"deep_research_clarification_provider\", None)\n-                            or self.config.default_provider\n+                        provider_id=resolve_phase_provider(\n+                            self.config, \"clarification\"\n                         ),\n                         timeout=self.config.get_phase_timeout(\"planning\"),  # Reuse planning timeout\n                     ),\ndiff --git a/tests/core/research/workflows/test_clarification.py b/tests/core/research/workflows/test_clarification.py\nindex 18adc88..e931cba 100644\n--- a/tests/core/research/workflows/test_clarification.py\n+++ b/tests/core/research/workflows/test_clarification.py\n@@ -279,7 +279,7 @@ That concludes my analysis.\"\"\"\n \n         assert result[\"inferred_constraints\"][\"depth\"] == \"detailed\"\n         assert result[\"inferred_constraints\"][\"max_results\"] == \"10\"\n-        assert result[\"inferred_constraints\"][\"include_images\"] == \"True\"\n+        assert result[\"inferred_constraints\"][\"include_images\"] == \"true\"\n         assert result[\"inferred_constraints\"][\"score_threshold\"] == \"0.8\"\n \n     def test_non_list_questions_ignored(self) -> None:\ndiff --git a/tests/core/research/workflows/test_deep_research.py b/tests/core/research/workflows/test_deep_research.py\nindex ca42bf7..d5bed1e 100644\n--- a/tests/core/research/workflows/test_deep_research.py\n+++ b/tests/core/research/workflows/test_deep_research.py\n@@ -58,6 +58,15 @@ def mock_config():\n     config.deep_research_analysis_provider = None\n     config.deep_research_synthesis_provider = None\n     config.deep_research_refinement_provider = None\n+    # Clarification provider configuration\n+    config.deep_research_clarification_provider = None\n+    # Topic agent configuration\n+    config.deep_research_topic_reflection_provider = None\n+    config.deep_research_reflection_provider = None\n+    config.deep_research_topic_max_searches = 3\n+    config.deep_research_enable_topic_agents = False\n+    # Stale task threshold\n+    config.deep_research_stale_task_seconds = 300.0\n \n     # Helper method mocks\n     def get_phase_timeout(phase: str) -> float:\ndiff --git a/tests/unit/test_core/autonomy/test_concurrency_scale.py b/tests/unit/test_core/autonomy/test_concurrency_scale.py\nindex 9a7368b..577c925 100644\n--- a/tests/unit/test_core/autonomy/test_concurrency_scale.py\n+++ b/tests/unit/test_core/autonomy/test_concurrency_scale.py\n@@ -352,3 +352,122 @@ class TestConcurrentPollingPerformance:\n \n         assert not errors, f\"Concurrent load/save errors: {errors}\"\n         assert max_elapsed_ms < 200, f\"Slowest load/save took {max_elapsed_ms:.1f}ms (target: <200ms)\"\n+\n+\n+# =============================================================================\n+# T12.5: Spec Cache Concurrency (StepOrchestrator)\n+# =============================================================================\n+\n+\n+class TestSpecCacheConcurrency:\n+    \"\"\"Verify spec cache thread safety under concurrent access.\"\"\"\n+\n+    def _make_orchestrator(self, tmp_path):\n+        \"\"\"Create a StepOrchestrator with mocked dependencies.\"\"\"\n+        from foundry_mcp.core.autonomy.orchestrator import StepOrchestrator\n+\n+        storage = AutonomyStorage(\n+            storage_path=tmp_path / \"sessions\",\n+            workspace_path=tmp_path,\n+        )\n+        spec_loader = MagicMock()\n+        return StepOrchestrator(\n+            storage=storage,\n+            spec_loader=spec_loader,\n+            workspace_path=tmp_path,\n+        )\n+\n+    def test_concurrent_compute_next_step_shared_cache(self, tmp_path):\n+        \"\"\"8 threads calling compute_next_step with shared spec cache \u2014 no errors.\n+\n+        Each thread creates its own session bound to the same spec, then\n+        calls compute_next_step.  The orchestrator's _spec_cache is shared\n+        across threads, so this exercises the locking.\n+        \"\"\"\n+        import json\n+\n+        orchestrator = self._make_orchestrator(tmp_path)\n+\n+        # Create a spec file on disk\n+        spec_id = \"conc-spec-001\"\n+        specs_dir = tmp_path / \"specs\" / \"active\"\n+        specs_dir.mkdir(parents=True)\n+        spec_data = make_spec_data(spec_id=spec_id)\n+        spec_data[\"title\"] = \"Concurrency Test Spec\"\n+        spec_data[\"journal\"] = []\n+        (specs_dir / f\"{spec_id}.json\").write_text(json.dumps(spec_data, indent=2))\n+\n+        errors: List[Exception] = []\n+        num_threads = 8\n+\n+        def call_compute(thread_idx: int):\n+            try:\n+                session = make_session(\n+                    session_id=f\"conc-sess-{thread_idx:03d}\",\n+                    spec_id=spec_id,\n+                )\n+                # compute_next_step will attempt to validate spec integrity\n+                # which reads/writes the spec cache under the lock\n+                orchestrator.compute_next_step(session)\n+            except Exception as e:\n+                errors.append(e)\n+\n+        threads = [threading.Thread(target=call_compute, args=(i,)) for i in range(num_threads)]\n+        for t in threads:\n+            t.start()\n+        for t in threads:\n+            t.join(timeout=15)\n+\n+        assert not errors, f\"Concurrent compute_next_step raised errors: {errors}\"\n+\n+    def test_invalidate_during_concurrent_reads(self, tmp_path):\n+        \"\"\"Invalidation loop + 4 reader threads \u2014 no crashes or corruption.\n+\n+        One thread repeatedly invalidates the spec cache while 4 reader\n+        threads access _spec_cache via the lock.  No thread should crash.\n+        \"\"\"\n+        orchestrator = self._make_orchestrator(tmp_path)\n+\n+        errors: List[Exception] = []\n+        stop_event = threading.Event()\n+\n+        def invalidation_loop():\n+            \"\"\"Repeatedly invalidate spec cache.\"\"\"\n+            try:\n+                for _ in range(200):\n+                    if stop_event.is_set():\n+                        break\n+                    orchestrator.invalidate_spec_cache()\n+                    # Also test targeted invalidation\n+                    orchestrator.invalidate_spec_cache(spec_id=\"some-spec\")\n+            except Exception as e:\n+                errors.append(e)\n+\n+        def reader_loop(thread_idx: int):\n+            \"\"\"Repeatedly read spec cache through the lock.\"\"\"\n+            try:\n+                for _ in range(200):\n+                    if stop_event.is_set():\n+                        break\n+                    # Access spec cache under lock (simulates _validate_spec_integrity fast-path)\n+                    with orchestrator._spec_cache_lock:\n+                        cache = orchestrator._spec_cache\n+                        if cache is not None:\n+                            # Read all fields to detect corruption\n+                            _ = (cache[0], cache[1], cache[2], cache[3])\n+            except Exception as e:\n+                errors.append(e)\n+\n+        invalidator = threading.Thread(target=invalidation_loop)\n+        readers = [threading.Thread(target=reader_loop, args=(i,)) for i in range(4)]\n+\n+        invalidator.start()\n+        for r in readers:\n+            r.start()\n+\n+        invalidator.join(timeout=10)\n+        for r in readers:\n+            r.join(timeout=10)\n+\n+        stop_event.set()\n+        assert not errors, f\"Concurrent cache operations raised errors: {errors}\"\ndiff --git a/tests/unit/test_core/test_authorization.py b/tests/unit/test_core/test_authorization.py\nindex 7d02b98..2620c71 100644\n--- a/tests/unit/test_core/test_authorization.py\n+++ b/tests/unit/test_core/test_authorization.py\n@@ -83,9 +83,10 @@ class TestServerRoleVar:\n         # Reset\n         set_server_role(\"maintainer\")\n \n-    def test_set_invalid_role_falls_back_to_maintainer(self):\n+    def test_set_invalid_role_falls_back_to_observer(self):\n+        \"\"\"Invalid roles fall back to observer (fail-closed) instead of maintainer.\"\"\"\n         set_server_role(\"invalid_role\")\n-        assert get_server_role() == \"maintainer\"\n+        assert get_server_role() == \"observer\"\n \n     def test_role_propagates_to_new_thread_via_process_fallback(self):\n         set_server_role(\"maintainer\")\n","truncated":false}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      ^^^^^
NameError: name 'false' is not defined. Did you mean: 'False'?
