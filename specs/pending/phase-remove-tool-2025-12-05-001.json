{
  "spec_id": "phase-remove-tool-2025-12-05-001",
  "title": "Add phase-remove MCP Tool",
  "generated": "2025-12-05T17:09:56.395787Z",
  "last_updated": "2025-12-05T17:11:25.126482Z",
  "metadata": {
    "description": "",
    "objectives": [],
    "complexity": "medium",
    "estimated_hours": 15,
    "assumptions": [
      "When removing a middle phase, the predecessor will automatically re-link to the successor to preserve the dependency chain",
      "Removal is blocked by default if phase has completed or in_progress tasks; requires force=True to override",
      "Cascade deletion is implicit since phases always have children (minimum: 2 verification nodes)",
      "Reuse existing helper functions from task.py: _collect_descendants, _count_tasks_in_subtree, _remove_dependency_references"
    ],
    "status": "pending",
    "owner": "",
    "progress_percentage": 0,
    "current_phase": "phase-1",
    "category": "implementation",
    "template": "medium",
    "title": "Add phase-remove MCP Tool"
  },
  "progress_percentage": 0,
  "status": "pending",
  "current_phase": "phase-1",
  "hierarchy": {
    "spec-root": {
      "type": "spec",
      "title": "phase-remove-tool",
      "status": "in_progress",
      "parent": null,
      "children": [
        "phase-1",
        "phase-2"
      ],
      "total_tasks": 7,
      "completed_tasks": 0,
      "metadata": {
        "purpose": "",
        "category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "phase-1": {
      "type": "phase",
      "title": "Planning & Discovery",
      "status": "pending",
      "parent": "spec-root",
      "children": [
        "task-1-1",
        "task-1-2",
        "verify-1-1",
        "verify-1-2"
      ],
      "total_tasks": 3,
      "completed_tasks": 0,
      "metadata": {
        "purpose": "Initial planning and requirements gathering",
        "estimated_hours": 2
      },
      "dependencies": {
        "blocks": [
          "phase-2"
        ],
        "blocked_by": [],
        "depends": []
      }
    },
    "verify-1-1": {
      "type": "verify",
      "title": "Run tests",
      "status": "pending",
      "parent": "phase-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "run-tests",
        "mcp_tool": "mcp__foundry-mcp__test-run",
        "expected": "All tests pass"
      },
      "dependencies": {
        "blocks": [
          "verify-1-2"
        ],
        "blocked_by": [],
        "depends": []
      }
    },
    "verify-1-2": {
      "type": "verify",
      "title": "Fidelity review",
      "status": "pending",
      "parent": "phase-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "fidelity",
        "mcp_tool": "mcp__foundry-mcp__spec-review-fidelity",
        "scope": "phase",
        "target": "phase-1",
        "expected": "Implementation matches specification"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "verify-1-1"
        ],
        "depends": []
      }
    },
    "phase-2": {
      "type": "phase",
      "title": "Implementation",
      "status": "pending",
      "parent": "spec-root",
      "children": [
        "task-2-1",
        "task-2-2",
        "task-2-3",
        "verify-2-1",
        "verify-2-2"
      ],
      "total_tasks": 4,
      "completed_tasks": 0,
      "metadata": {
        "purpose": "Core implementation work",
        "estimated_hours": 8
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "phase-1"
        ],
        "depends": []
      }
    },
    "verify-2-1": {
      "type": "verify",
      "title": "Run tests",
      "status": "pending",
      "parent": "phase-2",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "run-tests",
        "mcp_tool": "mcp__foundry-mcp__test-run",
        "expected": "All tests pass"
      },
      "dependencies": {
        "blocks": [
          "verify-2-2"
        ],
        "blocked_by": [],
        "depends": []
      }
    },
    "verify-2-2": {
      "type": "verify",
      "title": "Fidelity review",
      "status": "pending",
      "parent": "phase-2",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "fidelity",
        "mcp_tool": "mcp__foundry-mcp__spec-review-fidelity",
        "scope": "phase",
        "target": "phase-2",
        "expected": "Implementation matches specification"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "verify-2-1"
        ],
        "depends": []
      }
    },
    "task-1-1": {
      "type": "task",
      "title": "Add PHASE_NOT_FOUND error code to responses.py",
      "status": "pending",
      "parent": "phase-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Add PHASE_NOT_FOUND to the ErrorCode enum in src/foundry_mcp/core/responses.py to provide machine-readable error identification for phase-related errors.",
        "estimated_hours": 0.25
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-1-2": {
      "type": "task",
      "title": "Add remove_phase() core function to spec.py",
      "status": "pending",
      "parent": "phase-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Implement remove_phase() function in src/foundry_mcp/core/spec.py. Must handle: input validation, phase existence check, force flag for active tasks, adjacent phase re-linking, cascade deletion of children, spec-root count updates, and dependency cleanup. Reuse helpers from task.py: _collect_descendants, _count_tasks_in_subtree, _remove_dependency_references.",
        "estimated_hours": 2.0
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-2-1": {
      "type": "task",
      "title": "Add phase_remove_tool() MCP wrapper to authoring.py",
      "status": "pending",
      "parent": "phase-2",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Implement phase_remove_tool() in src/foundry_mcp/tools/authoring.py using @canonical_tool decorator. Parameters: spec_id, phase_id, force (default False), dry_run, path. Map errors to appropriate ErrorCode values. Return structured response with phase_id, children_removed, tasks_removed, verify_nodes_removed, and relinked info.",
        "estimated_hours": 1.5
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-2-2": {
      "type": "task",
      "title": "Add unit tests for remove_phase() core function",
      "status": "pending",
      "parent": "phase-2",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Add TestRemovePhase class to tests/unit/test_core/test_spec.py with tests: remove_phase_success, remove_middle_phase_relinks_adjacent, remove_first_phase_clears_successor, remove_last_phase_clears_predecessor, blocked_with_active_tasks, force_with_active_tasks, updates_spec_root_counts, cleans_dependency_references, nonexistent_phase_error, non_phase_node_error.",
        "estimated_hours": 1.5
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-2-3": {
      "type": "task",
      "title": "Add integration test and update capabilities manifest",
      "status": "pending",
      "parent": "phase-2",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Add test_phase_remove_registered to tests/integration/test_authoring_tools.py. Update mcp/capabilities_manifest.json with phase-remove tool entry.",
        "estimated_hours": 0.5
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    }
  },
  "journal": []
}