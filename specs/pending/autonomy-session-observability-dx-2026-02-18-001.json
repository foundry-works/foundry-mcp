{
  "spec_id": "autonomy-session-observability-dx-2026-02-18-001",
  "title": "autonomy-session-observability-dx",
  "generated": "2026-02-18T23:17:00.495349Z",
  "last_updated": "2026-02-18T23:19:25.436946Z",
  "metadata": {
    "description": "",
    "mission": "Add real-time monitoring (watch), graceful stopping (stop), and tmux-based launching (run) for unattended autonomous sessions, plus rename CLI from sdd/foundry-cli to foundry.",
    "objectives": [],
    "complexity": "low",
    "estimated_hours": 0,
    "assumptions": [],
    "owner": "",
    "category": "implementation",
    "template": "empty"
  },
  "progress_percentage": 0,
  "status": "pending",
  "current_phase": null,
  "hierarchy": {
    "spec-root": {
      "type": "spec",
      "title": "autonomy-session-observability-dx",
      "status": "pending",
      "parent": null,
      "children": [
        "phase-1",
        "phase-2",
        "phase-3",
        "phase-4",
        "phase-5",
        "phase-6",
        "phase-7"
      ],
      "total_tasks": 41,
      "completed_tasks": 0,
      "metadata": {
        "purpose": "",
        "category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "phase-1": {
      "type": "phase",
      "title": "CLI Rename & Configuration",
      "status": "pending",
      "parent": "spec-root",
      "children": [
        "task-1-1",
        "task-1-2",
        "task-1-3",
        "task-1-4",
        "task-1-5",
        "verify-1-1"
      ],
      "total_tasks": 6,
      "completed_tasks": 0,
      "metadata": {
        "purpose": "",
        "description": "Establish foundry as the primary CLI entry point and add the rich dependency. Unblocks all subsequent phases that create new commands."
      },
      "dependencies": {
        "blocks": [
          "phase-2"
        ],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-1-1": {
      "type": "task",
      "title": "Add foundry entry point and foundry-cli alias in pyproject.toml",
      "status": "pending",
      "parent": "phase-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Add foundry = foundry_mcp.cli.main:cli as primary entry point in [project.scripts]. Keep foundry-cli as backward-compatible alias.",
        "file_path": "pyproject.toml",
        "acceptance_criteria": [
          "foundry entry point added to [project.scripts]",
          "foundry-cli alias retained for backward compatibility",
          "pip install -e . succeeds"
        ],
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-1-2": {
      "type": "task",
      "title": "Add rich>=13.0.0 to dependencies",
      "status": "pending",
      "parent": "phase-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Add rich>=13.0.0 to the main dependencies list. Required for the Rich Live dashboard in the watch command.",
        "file_path": "pyproject.toml",
        "acceptance_criteria": [
          "rich>=13.0.0 in dependencies list",
          "pip install -e . installs rich successfully"
        ],
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-1-3": {
      "type": "task",
      "title": "Update pyproject.toml keywords from sdd to foundry",
      "status": "pending",
      "parent": "phase-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Change keywords list: replace 'sdd' with 'foundry'.",
        "file_path": "pyproject.toml",
        "acceptance_criteria": [
          "keywords contains 'foundry' instead of 'sdd'"
        ],
        "task_category": "refactoring"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-1-4": {
      "type": "task",
      "title": "Rename CLI to Foundry CLI in main.py",
      "status": "pending",
      "parent": "phase-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Update module docstring from 'SDD CLI entry point' to 'Foundry CLI entry point'. Update the cli() group docstring from 'SDD CLI' to 'Foundry CLI'. Accept FOUNDRY_SPECS_DIR envvar with SDD_SPECS_DIR fallback for the --specs-dir option.",
        "file_path": "src/foundry_mcp/cli/main.py",
        "acceptance_criteria": [
          "No 'SDD' in docstrings",
          "FOUNDRY_SPECS_DIR envvar accepted",
          "SDD_SPECS_DIR still works as fallback"
        ],
        "task_category": "refactoring"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-1-5": {
      "type": "task",
      "title": "Update registry.py docstrings from SDD to Foundry",
      "status": "pending",
      "parent": "phase-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Update module docstring and comments from 'SDD CLI' to 'Foundry CLI'.",
        "file_path": "src/foundry_mcp/cli/registry.py",
        "acceptance_criteria": [
          "No 'SDD' references in registry.py"
        ],
        "task_category": "refactoring"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "verify-1-1": {
      "type": "verify",
      "title": "Verify CLI rename and entry points",
      "status": "pending",
      "parent": "phase-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Run pip install -e . and verify: foundry --help works, foundry-cli --help works, both show 'Foundry CLI' branding.",
        "verification_type": "run-tests"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "phase-2": {
      "type": "phase",
      "title": "Signal File Infrastructure (Orchestrator)",
      "status": "pending",
      "parent": "spec-root",
      "children": [
        "task-2-1",
        "task-2-2",
        "verify-2-1"
      ],
      "total_tasks": 3,
      "completed_tasks": 0,
      "metadata": {
        "purpose": "",
        "description": "Add server-side signal file checking to the orchestrator so that foundry stop can trigger a clean PAUSE without modifying session state directly. Critical enabler for graceful intervention."
      },
      "dependencies": {
        "blocks": [
          "phase-3"
        ],
        "blocked_by": [
          "phase-1"
        ],
        "depends": []
      }
    },
    "task-2-1": {
      "type": "task",
      "title": "Add Step 7b signal file check to compute_next_step()",
      "status": "pending",
      "parent": "phase-2",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Add Step 7b between Step 7 (heartbeat staleness) and Step 8 (pause guards). Check for specs/.autonomy/signals/{spec_id}.stop file. If found: consume (unlink) the signal file, set session status to PAUSED with PauseReason.USER, set paused_at timestamp, emit PAUSE audit event with action='operator_stop_signal', return pause response. Best-effort cleanup on unlink failure.",
        "file_path": "src/foundry_mcp/core/autonomy/orchestrator.py",
        "acceptance_criteria": [
          "Step 7b check exists between Step 7 and Step 8",
          "Signal file detected triggers PAUSED with PauseReason.USER",
          "Signal file is consumed (deleted) after detection",
          "Audit event emitted with action=operator_stop_signal",
          "No-op when signal file does not exist",
          "Existing tests still pass"
        ],
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-2-2": {
      "type": "task",
      "title": "Write unit tests for signal file detection in orchestrator",
      "status": "pending",
      "parent": "phase-2",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Add tests: (1) signal file exists -> returns PAUSE step with PauseReason.USER, (2) signal file is deleted after consumption, (3) no signal file -> no effect on normal flow, (4) signal file unlink failure is handled gracefully (best-effort).",
        "file_path": "tests/unit/test_core/autonomy/test_orchestrator.py",
        "acceptance_criteria": [
          "Test: signal file triggers PAUSE response",
          "Test: signal file consumed after detection",
          "Test: normal flow unaffected when no signal",
          "Test: OSError on unlink handled gracefully",
          "All tests pass"
        ],
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "verify-2-1": {
      "type": "verify",
      "title": "Verify signal file infrastructure",
      "status": "pending",
      "parent": "phase-2",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Run python -m pytest tests/unit/test_core/autonomy/test_orchestrator.py --tb=short. All tests pass including new signal file tests.",
        "verification_type": "run-tests"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "phase-3": {
      "type": "phase",
      "title": "foundry stop Command",
      "status": "pending",
      "parent": "spec-root",
      "children": [
        "task-3-1",
        "task-3-2",
        "task-3-3",
        "task-3-4",
        "task-3-5",
        "verify-3-1"
      ],
      "total_tasks": 6,
      "completed_tasks": 0,
      "metadata": {
        "purpose": "",
        "description": "Operator-facing CLI command to gracefully stop a running autonomous session. Uses signal file mechanism from Phase 2."
      },
      "dependencies": {
        "blocks": [
          "phase-4"
        ],
        "blocked_by": [
          "phase-2"
        ],
        "depends": []
      }
    },
    "task-3-1": {
      "type": "task",
      "title": "Create foundry stop CLI command",
      "status": "pending",
      "parent": "phase-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Create new Click command: @click.command('stop') with spec_id argument, --force flag, --wait flag, --timeout option (default 120s). Implementation: (1) validate spec_id exists via spec finder, (2) find active session via AutonomyMemory.get_active_session(), (3) create specs/.autonomy/signals/ dir (mkdir -p), (4) write signal file specs/.autonomy/signals/{spec_id}.stop with JSON payload {requested_at, requested_by: foundry-cli, reason: operator_stop}, (5) print confirmation message. Use existing CLI patterns: @cli_command decorator, emit_success/emit_error, handle_keyboard_interrupt.",
        "file_path": "src/foundry_mcp/cli/commands/stop.py",
        "acceptance_criteria": [
          "Click command with spec_id arg and --force/--wait/--timeout options",
          "Signal file written with correct JSON payload",
          "Signal directory created if missing",
          "Error handling for missing spec or no active session",
          "Follows existing CLI patterns (decorators, output helpers)"
        ],
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-3-2": {
      "type": "task",
      "title": "Implement --force mode (process kill)",
      "status": "pending",
      "parent": "phase-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "When --force is passed, after writing signal file: use subprocess to run pgrep -f 'foundry-implement-auto.*{spec_id}' to find matching claude processes, send SIGTERM via os.kill() to each matched PID, print confirmation for each killed process. Handle cases: no matching process found, permission denied, process already exited.",
        "file_path": "src/foundry_mcp/cli/commands/stop.py",
        "acceptance_criteria": [
          "Finds claude processes matching the spec_id",
          "Sends SIGTERM to matched PIDs",
          "Handles no-match, permission errors, already-exited gracefully",
          "Prints confirmation per killed process"
        ],
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-3-3": {
      "type": "task",
      "title": "Implement --wait mode (poll until stopped)",
      "status": "pending",
      "parent": "phase-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "When --wait is passed, after writing signal file (and optional --force): poll session status every 2 seconds via AutonomyMemory.load(). Exit when session status is PAUSED, COMPLETED, ENDED, or FAILED. Timeout after --timeout seconds (default 120). Print final session status on exit. Use AutonomyMemory from core/autonomy/memory.py.",
        "file_path": "src/foundry_mcp/cli/commands/stop.py",
        "acceptance_criteria": [
          "Polls session status every 2 seconds",
          "Exits on terminal session status",
          "Respects --timeout option",
          "Prints final status"
        ],
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-3-4": {
      "type": "task",
      "title": "Register stop command in CLI",
      "status": "pending",
      "parent": "phase-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Import stop command from stop.py and add to __all__. Register in registry.py via cli.add_command(stop).",
        "file_path": "src/foundry_mcp/cli/commands/__init__.py",
        "acceptance_criteria": [
          "stop imported in __init__.py",
          "stop in __all__ list",
          "stop registered in registry.py"
        ],
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-3-5": {
      "type": "task",
      "title": "Write unit tests for stop command",
      "status": "pending",
      "parent": "phase-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Tests: (1) signal file created with correct JSON payload, (2) error when no active session found, (3) --force mode finds and kills processes (mock subprocess/os.kill), (4) --wait mode polls and exits on terminal status (mock AutonomyMemory), (5) --wait mode times out correctly.",
        "file_path": "tests/unit/test_cli/test_stop.py",
        "acceptance_criteria": [
          "Test: signal file creation",
          "Test: no active session error",
          "Test: force mode process kill",
          "Test: wait mode poll and exit",
          "Test: wait mode timeout"
        ],
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "verify-3-1": {
      "type": "verify",
      "title": "Verify foundry stop command",
      "status": "pending",
      "parent": "phase-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "foundry stop --help works. python -m pytest tests/unit/test_cli/test_stop.py --tb=short passes.",
        "verification_type": "run-tests"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "phase-4": {
      "type": "phase",
      "title": "foundry watch Command",
      "status": "pending",
      "parent": "spec-root",
      "children": [
        "task-4-1",
        "task-4-2",
        "task-4-3",
        "task-4-4",
        "task-4-5",
        "task-4-6",
        "verify-4-1"
      ],
      "total_tasks": 7,
      "completed_tasks": 0,
      "metadata": {
        "purpose": "",
        "description": "Rich Live dashboard for real-time monitoring of autonomous sessions. Reads session state, audit ledger, and spec progress directly from disk."
      },
      "dependencies": {
        "blocks": [
          "phase-5"
        ],
        "blocked_by": [
          "phase-3"
        ],
        "depends": []
      }
    },
    "task-4-1": {
      "type": "task",
      "title": "Create foundry watch CLI command with data assembly",
      "status": "pending",
      "parent": "phase-4",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Create Click command: @click.command('watch') with spec_id argument, --interval/-n (default 2.0s), --events (default 10), --simple flag. Data assembly: resolve spec_id to session_id via AutonomyMemory.get_active_session() (from core/autonomy/memory.py:635), load session state via AutonomyMemory.load() (memory.py:330), load audit events via AuditLedger.get_entries() (core/autonomy/audit.py), load spec progress via recalculate_progress() (core/progress.py:33). Handle errors: no active session, spec not found.",
        "file_path": "src/foundry_mcp/cli/commands/watch.py",
        "acceptance_criteria": [
          "Click command with spec_id arg and all options",
          "Resolves spec_id to active session",
          "Loads session state, audit events, spec progress",
          "Error handling for missing session/spec"
        ],
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-4-2": {
      "type": "task",
      "title": "Implement Rich Live dashboard layout",
      "status": "pending",
      "parent": "phase-4",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Build Rich Live display with three panels: (1) Status panel - session ID, status, active phase, task progress bar (completed/total), context usage %, heartbeat age in seconds. (2) Current step panel - step type, task ID, step ID (truncated), time since issued. (3) Recent events table - timestamp, event type, task ID, metadata (outcome, step_type, verdict). Use Rich Panel, Table, Progress bar, and Live context. Poll every --interval seconds. Auto-exit when session reaches terminal state (COMPLETED/FAILED/ENDED/PAUSED).",
        "file_path": "src/foundry_mcp/cli/commands/watch.py",
        "acceptance_criteria": [
          "Status panel shows session ID, status, phase, progress, context %, heartbeat",
          "Current step panel shows step type, task, time since issued",
          "Events table shows recent audit events with metadata",
          "Display updates every interval seconds",
          "Auto-exits on terminal session state"
        ],
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-4-3": {
      "type": "task",
      "title": "Implement keyboard handling (q to quit, s to stop)",
      "status": "pending",
      "parent": "phase-4",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Add non-blocking keyboard input handling in the poll loop. q key exits the watch command. s key writes the stop signal file (reuse signal file write logic from stop command \u2014 extract to shared helper if needed). Use select/termios for non-blocking stdin read on macOS/Linux.",
        "file_path": "src/foundry_mcp/cli/commands/watch.py",
        "acceptance_criteria": [
          "q key exits watch cleanly",
          "s key writes stop signal file",
          "Keyboard handling is non-blocking",
          "Works on macOS"
        ],
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-4-4": {
      "type": "task",
      "title": "Implement --simple streaming mode",
      "status": "pending",
      "parent": "phase-4",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "When --simple flag is passed, skip Rich Live and instead: print a header line with session info (ID, status, spec_id), then tail the audit ledger by tracking last-seen sequence number, printing one formatted line per new event (timestamp, event_type, task_id, metadata). Exit on terminal session state. This mode works with pipes, tmux, and log aggregation.",
        "file_path": "src/foundry_mcp/cli/commands/watch.py",
        "acceptance_criteria": [
          "Header line printed with session info",
          "New audit events printed one per line",
          "Uses last-seen sequence for incremental output",
          "Exits on terminal state",
          "Works with pipes (no Rich escape codes)"
        ],
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-4-5": {
      "type": "task",
      "title": "Register watch command in CLI",
      "status": "pending",
      "parent": "phase-4",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Import watch command from watch.py and add to __all__. Register in registry.py via cli.add_command(watch).",
        "file_path": "src/foundry_mcp/cli/commands/__init__.py",
        "acceptance_criteria": [
          "watch imported in __init__.py",
          "watch in __all__ list",
          "watch registered in registry.py"
        ],
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-4-6": {
      "type": "task",
      "title": "Write unit tests for watch command",
      "status": "pending",
      "parent": "phase-4",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Tests: (1) data assembly correctly resolves session and loads state (mock AutonomyMemory + AuditLedger), (2) error when no active session, (3) simple mode outputs formatted event lines (mock audit ledger), (4) terminal state detection exits the loop.",
        "file_path": "tests/unit/test_cli/test_watch.py",
        "acceptance_criteria": [
          "Test: data assembly",
          "Test: no active session error",
          "Test: simple mode output format",
          "Test: terminal state exit"
        ],
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "verify-4-1": {
      "type": "verify",
      "title": "Verify foundry watch command",
      "status": "pending",
      "parent": "phase-4",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "foundry watch --help works. python -m pytest tests/unit/test_cli/test_watch.py --tb=short passes.",
        "verification_type": "run-tests"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "phase-5": {
      "type": "phase",
      "title": "foundry run Command (tmux Launcher)",
      "status": "pending",
      "parent": "spec-root",
      "children": [
        "task-5-1",
        "task-5-2",
        "task-5-3",
        "verify-5-1"
      ],
      "total_tasks": 4,
      "completed_tasks": 0,
      "metadata": {
        "purpose": "",
        "description": "One-command launch that creates a tmux session with the agent in one pane and the watcher in another. Best possible DX for running autonomous sessions."
      },
      "dependencies": {
        "blocks": [
          "phase-6"
        ],
        "blocked_by": [
          "phase-4"
        ],
        "depends": []
      }
    },
    "task-5-1": {
      "type": "task",
      "title": "Create foundry run CLI command with tmux session management",
      "status": "pending",
      "parent": "phase-5",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Create Click command: @click.command('run') with spec_id argument, --posture (choice: unattended/supervised, default unattended), --detach/-d flag, --layout (choice: horizontal/vertical, default vertical). Implementation: (1) check tmux installed via shutil.which('tmux') with clear error if missing, (2) generate tmux session name foundry-{spec_id[:30]}, (3) build agent command: FOUNDRY_MCP_ROLE=autonomy_runner FOUNDRY_MCP_AUTONOMY_POSTURE={posture} claude -p '/foundry-implement-auto {spec_id}' --dangerously-skip-permissions, (4) build watcher command: sleep 5 && foundry watch {spec_id}, (5) create tmux session via subprocess: tmux new-session -d -s {name} '{agent_cmd}', tmux split-window -t {name} -{h|v} '{watcher_cmd}', tmux select-pane -t {name}:0.0, (6) if not --detach: tmux attach -t {name}, (7) print reattach command.",
        "file_path": "src/foundry_mcp/cli/commands/run.py",
        "acceptance_criteria": [
          "Click command with all options",
          "Checks tmux availability with clear error",
          "Creates tmux session with agent + watcher panes",
          "Agent pane runs claude -p with correct env vars",
          "Watcher pane runs foundry watch with delay",
          "Attach by default, print reattach when detached",
          "Layout option controls split direction"
        ],
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-5-2": {
      "type": "task",
      "title": "Register run command in CLI",
      "status": "pending",
      "parent": "phase-5",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Import run command from run.py (as run_cmd to avoid shadowing builtin) and add to __all__. Register in registry.py via cli.add_command(run_cmd).",
        "file_path": "src/foundry_mcp/cli/commands/__init__.py",
        "acceptance_criteria": [
          "run_cmd imported in __init__.py",
          "run_cmd in __all__ list",
          "run_cmd registered in registry.py"
        ],
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-5-3": {
      "type": "task",
      "title": "Write unit tests for run command",
      "status": "pending",
      "parent": "phase-5",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Tests: (1) tmux not found shows clear error (mock shutil.which), (2) correct tmux commands constructed for default options (mock subprocess), (3) --detach skips attach, (4) --layout horizontal uses -h flag, (5) --posture supervised passes correct env var.",
        "file_path": "tests/unit/test_cli/test_run.py",
        "acceptance_criteria": [
          "Test: tmux missing error",
          "Test: correct tmux command construction",
          "Test: detach mode",
          "Test: layout option",
          "Test: posture option"
        ],
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "verify-5-1": {
      "type": "verify",
      "title": "Verify foundry run command",
      "status": "pending",
      "parent": "phase-5",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "foundry run --help works. python -m pytest tests/unit/test_cli/test_run.py --tb=short passes.",
        "verification_type": "run-tests"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "phase-6": {
      "type": "phase",
      "title": "SDD to Foundry Rename (Env Vars & Tool Names)",
      "status": "pending",
      "parent": "spec-root",
      "children": [
        "task-6-1",
        "task-6-2",
        "task-6-3",
        "task-6-4",
        "task-6-5",
        "task-6-6",
        "verify-6-1"
      ],
      "total_tasks": 7,
      "completed_tasks": 0,
      "metadata": {
        "purpose": "",
        "description": "Rename all SDD_* environment variables to FOUNDRY_* and all sdd-* MCP tool names to foundry-*. Maintain backward compatibility for env vars."
      },
      "dependencies": {
        "blocks": [
          "phase-7"
        ],
        "blocked_by": [
          "phase-5"
        ],
        "depends": []
      }
    },
    "task-6-1": {
      "type": "task",
      "title": "Rename SDD_SPECS_DIR env var with backward-compat fallback",
      "status": "pending",
      "parent": "phase-6",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Update config.py to accept FOUNDRY_SPECS_DIR as primary envvar, falling back to SDD_SPECS_DIR if FOUNDRY_SPECS_DIR is not set. Update error messages referencing SDD_SPECS_DIR.",
        "file_path": "src/foundry_mcp/cli/config.py",
        "acceptance_criteria": [
          "FOUNDRY_SPECS_DIR accepted as primary",
          "SDD_SPECS_DIR still works as fallback",
          "Error messages reference FOUNDRY_SPECS_DIR"
        ],
        "task_category": "refactoring"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-6-2": {
      "type": "task",
      "title": "Rename session env vars in cli/context.py",
      "status": "pending",
      "parent": "phase-6",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Rename: SDD_MAX_CONSULTATIONS -> FOUNDRY_MAX_CONSULTATIONS, SDD_MAX_CONTEXT_TOKENS -> FOUNDRY_MAX_CONTEXT_TOKENS, SDD_WARN_PERCENTAGE -> FOUNDRY_WARN_PERCENTAGE (all with SDD_* fallback). Change session ID prefix from sdd_{uuid} to foundry_{uuid}.",
        "file_path": "src/foundry_mcp/cli/context.py",
        "acceptance_criteria": [
          "All three env vars renamed with fallback",
          "Session ID prefix is foundry_",
          "Old env var names still work"
        ],
        "task_category": "refactoring"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-6-3": {
      "type": "task",
      "title": "Update SDD_SPECS_DIR references in 7 CLI command files",
      "status": "pending",
      "parent": "phase-6",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Update error messages and remediation strings in modify.py, tasks.py, lifecycle.py, journal.py, specs.py, validate.py, and review.py: replace SDD_SPECS_DIR with FOUNDRY_SPECS_DIR.",
        "file_path": "src/foundry_mcp/cli/commands/tasks.py",
        "acceptance_criteria": [
          "All 7 command files reference FOUNDRY_SPECS_DIR in messages",
          "No SDD_SPECS_DIR in error/remediation strings"
        ],
        "task_category": "refactoring"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-6-4": {
      "type": "task",
      "title": "Rename sdd-* tool metadata in discovery/metadata/environment.py",
      "status": "pending",
      "parent": "phase-6",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Rename 4 tool metadata entries: sdd-verify-toolchain -> foundry-verify-toolchain, sdd-init-workspace -> foundry-init-workspace, sdd-detect-topology -> foundry-detect-topology, sdd-verify-environment -> foundry-verify-environment. Update all related_tools arrays and examples.",
        "file_path": "src/foundry_mcp/core/discovery/metadata/environment.py",
        "acceptance_criteria": [
          "All 4 tool names use foundry- prefix",
          "related_tools arrays updated",
          "No sdd- references remain"
        ],
        "task_category": "refactoring"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-6-5": {
      "type": "task",
      "title": "Rename sdd-* tool aliases in tools/unified/environment.py",
      "status": "pending",
      "parent": "phase-6",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Rename tool aliases: sdd-detect-test-runner -> foundry-detect-test-runner, sdd-setup -> foundry-setup. Update audit_log('sdd_setup',...) to audit_log('foundry_setup',...). Update any other sdd references in the file.",
        "file_path": "src/foundry_mcp/tools/unified/environment.py",
        "acceptance_criteria": [
          "Tool aliases use foundry- prefix",
          "Audit log references foundry_setup",
          "No sdd references remain in file"
        ],
        "task_category": "refactoring"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-6-6": {
      "type": "task",
      "title": "Update test_environment.py for renamed tools",
      "status": "pending",
      "parent": "phase-6",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Update 5 test class docstrings referencing sdd_* function names to foundry_*. Update any tool name assertions that check for sdd-* prefixed names.",
        "file_path": "tests/unit/test_environment.py",
        "acceptance_criteria": [
          "Docstrings reference foundry_* names",
          "Tool name assertions use foundry-* prefix",
          "All tests pass"
        ],
        "task_category": "refactoring"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "verify-6-1": {
      "type": "verify",
      "title": "Verify env var and tool name rename",
      "status": "pending",
      "parent": "phase-6",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "python -m pytest tests/unit/test_environment.py tests/unit/test_cli/ --tb=short passes. Setting SDD_SPECS_DIR still works (backward compat).",
        "verification_type": "run-tests"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "phase-7": {
      "type": "phase",
      "title": "SDD to Foundry Rename (Schema, Files, Docs)",
      "status": "pending",
      "parent": "spec-root",
      "children": [
        "task-7-1",
        "task-7-2",
        "task-7-3",
        "task-7-4",
        "task-7-5",
        "task-7-6",
        "task-7-7",
        "verify-7-1"
      ],
      "total_tasks": 8,
      "completed_tasks": 0,
      "metadata": {
        "purpose": "",
        "description": "Complete the rename by updating schema files, test file names, documentation, and remaining internal references."
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "phase-6"
        ],
        "depends": []
      }
    },
    "task-7-1": {
      "type": "task",
      "title": "Rename schema file and update loader",
      "status": "pending",
      "parent": "phase-7",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Rename src/foundry_mcp/schemas/sdd-spec-schema.json to foundry-spec-schema.json. Update load_schema() default parameter in schemas/__init__.py (lines 8, 12, 38) to reference the new filename.",
        "file_path": "src/foundry_mcp/schemas/__init__.py",
        "acceptance_criteria": [
          "Schema file renamed to foundry-spec-schema.json",
          "load_schema() references new filename",
          "Schema loading still works"
        ],
        "task_category": "refactoring"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-7-2": {
      "type": "task",
      "title": "Update backup file suffix in cursor_agent.py",
      "status": "pending",
      "parent": "phase-7",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Change .sdd-backup suffix to .foundry-backup at line ~258.",
        "file_path": "src/foundry_mcp/core/providers/cursor_agent.py",
        "acceptance_criteria": [
          "Backup suffix is .foundry-backup"
        ],
        "task_category": "refactoring"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-7-3": {
      "type": "task",
      "title": "Update all CLI command file docstrings from SDD to Foundry",
      "status": "pending",
      "parent": "phase-7",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Update module-level docstrings in session.py and any other CLI command files that still reference 'SDD' to say 'Foundry' instead.",
        "file_path": "src/foundry_mcp/cli/commands/session.py",
        "acceptance_criteria": [
          "No SDD in any CLI command file docstrings"
        ],
        "task_category": "refactoring"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-7-4": {
      "type": "task",
      "title": "Rename test files from test_sdd_cli_* to test_foundry_cli_*",
      "status": "pending",
      "parent": "phase-7",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Rename three test files: test_sdd_cli_core.py -> test_foundry_cli_core.py, test_sdd_cli_runtime.py -> test_foundry_cli_runtime.py, test_sdd_cli_parity.py -> test_foundry_cli_parity.py. Update any internal references within these files.",
        "file_path": "tests/unit/test_sdd_cli_core.py",
        "acceptance_criteria": [
          "All three files renamed",
          "Internal references updated",
          "Tests still pass under new names"
        ],
        "task_category": "refactoring"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-7-5": {
      "type": "task",
      "title": "Update modified_by markers in test_spec.py",
      "status": "pending",
      "parent": "phase-7",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Change modified_by='sdd-cli' to modified_by='foundry-cli' at lines ~353, 360, 367.",
        "file_path": "tests/unit/test_core/test_spec.py",
        "acceptance_criteria": [
          "All modified_by markers say foundry-cli"
        ],
        "task_category": "refactoring"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-7-6": {
      "type": "task",
      "title": "Rename sdd-philosophy.md and update all links",
      "status": "pending",
      "parent": "phase-7",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Rename docs/concepts/sdd-philosophy.md to docs/concepts/foundry-philosophy.md. Update links in docs/README.md and README.md that point to the old filename. Update content references to SDD within the file itself.",
        "file_path": "docs/concepts/sdd-philosophy.md",
        "acceptance_criteria": [
          "File renamed to foundry-philosophy.md",
          "All links updated in README.md and docs/README.md",
          "Content references updated"
        ],
        "task_category": "refactoring"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-7-7": {
      "type": "task",
      "title": "Update remaining doc references to SDD env vars and commands",
      "status": "pending",
      "parent": "phase-7",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Update docs/04-cli-command-reference.md (env var table: SDD_SPECS_DIR -> FOUNDRY_SPECS_DIR), docs/07-troubleshooting.md (grep -i sdd example -> grep -i foundry), docs/reference/error-codes.md (SDD_SPECS_DIR reference).",
        "file_path": "docs/04-cli-command-reference.md",
        "acceptance_criteria": [
          "All three doc files updated",
          "No SDD references in env var docs",
          "Troubleshooting example uses foundry"
        ],
        "task_category": "refactoring"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "verify-7-1": {
      "type": "verify",
      "title": "Verify complete SDD rename",
      "status": "pending",
      "parent": "phase-7",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Full test suite: python -m pytest tests/ --tb=short -x passes. grep -ri 'sdd' src/ tests/ docs/ --include='*.py' --include='*.md' --include='*.json' | grep -v CHANGELOG | grep -v .backups | grep -v .reports returns no results.",
        "verification_type": "run-tests"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    }
  },
  "journal": []
}